---
phase: 04-quartz-and-vault
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - model-citizen-quartz/quartz.config.ts
  - model-citizen-quartz/quartz.layout.ts
  - model-citizen-quartz/.github/workflows/deploy.yml
  - model-citizen-quartz/content/index.md
autonomous: true

must_haves:
  truths:
    - "User can visit athan-dial.github.io/model-citizen/ and see Quartz landing page"
    - "User can run npx quartz build locally without errors"
    - "GitHub Actions workflow deploys on push to main"
  artifacts:
    - path: "model-citizen-quartz/quartz.config.ts"
      provides: "Quartz configuration with correct baseUrl"
      contains: "athan-dial.github.io/model-citizen"
    - path: "model-citizen-quartz/.github/workflows/deploy.yml"
      provides: "GitHub Actions deployment workflow"
      contains: "actions/deploy-pages@v4"
    - path: "model-citizen-quartz/content/index.md"
      provides: "Landing page content"
      min_lines: 5
  key_links:
    - from: "quartz.config.ts"
      to: "GitHub Pages"
      via: "baseUrl configuration"
      pattern: "baseUrl.*athan-dial.github.io/model-citizen"
    - from: ".github/workflows/deploy.yml"
      to: "GitHub Pages environment"
      via: "actions/deploy-pages"
      pattern: "deploy-pages@v4"
---

<objective>
Scaffold Quartz v4 repository and configure GitHub Actions deployment to athan-dial.github.io/model-citizen/

Purpose: Establish the publishing infrastructure for Model Citizen before building automation. This gives us a working deployment target to publish approved content to.

Output: Public GitHub repository `model-citizen-quartz` with working Quartz installation and automated GitHub Pages deployment.
</objective>

<execution_context>
@/Users/adial/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adial/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04-quartz-and-vault/04-CONTEXT.md
@.planning/phases/04-quartz-and-vault/04-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Quartz repository with project site configuration</name>
  <files>
    ~/model-citizen-quartz/quartz.config.ts
    ~/model-citizen-quartz/quartz.layout.ts
    ~/model-citizen-quartz/content/index.md
  </files>
  <action>
    1. Create directory: `mkdir -p ~/model-citizen-quartz && cd ~/model-citizen-quartz`

    2. Initialize Quartz using npx:
       ```bash
       npx quartz create
       ```
       Select "Empty Quartz" when prompted (no default content).

    3. Verify Node version is v22+: `node --version`
       If not v22+, run: `nvm install 22 && nvm use 22`

    4. Configure quartz.config.ts with these critical settings:
       - pageTitle: "Model Citizen"
       - baseUrl: "athan-dial.github.io/model-citizen" (NO https://, NO trailing slash)
       - ignorePatterns: Include all non-publish folders from vault schema
       - Add ExplicitPublish to filters array (safety guardrail)
       - Theme: Use Quartz defaults (defer customization to later phase)

    5. Configure quartz.layout.ts for knowledge garden aesthetic:
       - Left sidebar: Explorer (collapsed by default)
       - Right sidebar: Graph, TableOfContents, Backlinks
       - Footer: Link to source vault repo

    6. Create minimal landing page at content/index.md:
       ```yaml
       ---
       title: "Model Citizen"
       date: 2026-02-05
       status: "publish"
       ---

       # Model Citizen

       A public knowledge garden showing how ideas develop from raw sources to published articles.

       This site is the published output of an Obsidian vault that captures, enriches, and synthesizes content.

       [View the source vault](https://github.com/athan-dial/model-citizen-vault)
       ```

    7. Test local build: `npx quartz build --serve`
       Verify site loads at http://localhost:8080

    Reference 04-RESEARCH.md "Complete quartz.config.ts for Project Site" code example for exact configuration.
  </action>
  <verify>
    - `npx quartz build` completes without errors
    - `grep "athan-dial.github.io/model-citizen" quartz.config.ts` returns match
    - `ls content/index.md` confirms landing page exists
    - Local server at http://localhost:8080 shows "Model Citizen" page
  </verify>
  <done>
    Quartz repository created with correct baseUrl configuration, ignorePatterns for vault folders, and working local build.
  </done>
</task>

<task type="auto">
  <name>Task 2: Initialize Git repository and push to GitHub</name>
  <files>
    ~/model-citizen-quartz/.git
    ~/model-citizen-quartz/.gitignore
  </files>
  <action>
    1. Initialize git repo (if not already done by quartz create):
       ```bash
       cd ~/model-citizen-quartz
       git init
       ```

    2. Create .gitignore if not present (Quartz usually includes one):
       ```
       .quartz-cache
       node_modules
       public
       .DS_Store
       ```

    3. Create GitHub repository using gh CLI:
       ```bash
       gh repo create model-citizen-quartz --public --source=. --remote=origin
       ```
       If auth error, Claude should create checkpoint for user to authenticate.

    4. Add all files and commit:
       ```bash
       git add .
       git commit -m "feat: initial Quartz scaffolding with project site config"
       ```

    5. Push to GitHub:
       ```bash
       git push -u origin main
       ```
  </action>
  <verify>
    - `gh repo view athan-dial/model-citizen-quartz` shows repository exists
    - `git remote -v` shows origin pointing to github.com/athan-dial/model-citizen-quartz
    - Repository is public (visible at https://github.com/athan-dial/model-citizen-quartz)
  </verify>
  <done>
    Git repository initialized and pushed to GitHub as public repo `athan-dial/model-citizen-quartz`.
  </done>
</task>

<task type="auto">
  <name>Task 3: Configure GitHub Actions workflow and enable Pages deployment</name>
  <files>
    ~/model-citizen-quartz/.github/workflows/deploy.yml
  </files>
  <action>
    1. Create workflow directory:
       ```bash
       mkdir -p ~/model-citizen-quartz/.github/workflows
       ```

    2. Create deploy.yml with the following content (from 04-RESEARCH.md Pattern 5):
       ```yaml
       name: Deploy Quartz site to GitHub Pages

       on:
         push:
           branches:
             - main
         workflow_dispatch:

       permissions:
         contents: read
         pages: write
         id-token: write

       concurrency:
         group: "pages"
         cancel-in-progress: false

       jobs:
         build:
           runs-on: ubuntu-22.04
           steps:
             - name: Checkout
               uses: actions/checkout@v4
               with:
                 fetch-depth: 0

             - name: Setup Node
               uses: actions/setup-node@v4
               with:
                 node-version: 22

             - name: Install Dependencies
               run: npm ci

             - name: Build Quartz
               run: npx quartz build

             - name: Upload artifact
               uses: actions/upload-pages-artifact@v3
               with:
                 path: public

         deploy:
           environment:
             name: github-pages
             url: ${{ steps.deployment.outputs.page_url }}
           runs-on: ubuntu-22.04
           needs: build
           steps:
             - name: Deploy to GitHub Pages
               id: deployment
               uses: actions/deploy-pages@v4
       ```

    3. Commit and push workflow:
       ```bash
       cd ~/model-citizen-quartz
       git add .github/workflows/deploy.yml
       git commit -m "ci: add GitHub Actions workflow for Pages deployment"
       git push
       ```

    4. Enable GitHub Pages with Actions source using gh CLI:
       ```bash
       gh api repos/athan-dial/model-citizen-quartz/pages -X PUT -f build_type=workflow
       ```
       If this fails (Pages not yet enabled), try:
       ```bash
       gh api repos/athan-dial/model-citizen-quartz/pages -X POST -f build_type=workflow
       ```

    5. Verify workflow triggered:
       ```bash
       gh run list --repo athan-dial/model-citizen-quartz --limit 1
       ```

    6. Wait for workflow to complete (typically 1-2 minutes):
       ```bash
       gh run watch --repo athan-dial/model-citizen-quartz
       ```
  </action>
  <verify>
    - `gh run list --repo athan-dial/model-citizen-quartz` shows successful run
    - `gh api repos/athan-dial/model-citizen-quartz/pages` shows source as "workflow"
    - Site accessible at https://athan-dial.github.io/model-citizen/
  </verify>
  <done>
    GitHub Actions workflow deployed, Pages enabled with Actions source, and site accessible at production URL.
  </done>
</task>

</tasks>

<verification>
After all tasks complete:

1. **Local build works:**
   ```bash
   cd ~/model-citizen-quartz && npx quartz build
   ```
   Should complete without errors.

2. **Repository exists on GitHub:**
   ```bash
   gh repo view athan-dial/model-citizen-quartz --json url
   ```

3. **GitHub Pages enabled:**
   ```bash
   gh api repos/athan-dial/model-citizen-quartz/pages --jq '.status'
   ```
   Should return "built".

4. **Site accessible:**
   ```bash
   curl -s -o /dev/null -w "%{http_code}" https://athan-dial.github.io/model-citizen/
   ```
   Should return 200.
</verification>

<success_criteria>
- Quartz v4 repository exists at github.com/athan-dial/model-citizen-quartz
- quartz.config.ts has baseUrl set to "athan-dial.github.io/model-citizen"
- GitHub Actions workflow runs successfully on push to main
- Site is accessible at https://athan-dial.github.io/model-citizen/
- Landing page displays "Model Citizen" title
</success_criteria>

<output>
After completion, create `.planning/phases/04-quartz-and-vault/04-01-SUMMARY.md`
</output>
