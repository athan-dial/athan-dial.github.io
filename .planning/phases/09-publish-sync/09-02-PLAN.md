---
phase: 09-publish-sync
plan: 02
type: execute
wave: 2
depends_on: ["09-01"]
files_modified:
  - ~/Library/Mobile Documents/iCloud~md~obsidian/Documents/model-citizen-vault/publish_queue/*.md
  - ~/Library/Mobile Documents/iCloud~md~obsidian/Documents/model-citizen-quartz/content/*.md
autonomous: false

must_haves:
  truths:
    - "A real piece of content flows from YouTube ingestion through enrichment to published Quartz site"
    - "Published article is visible at athan-dial.github.io/model-citizen/"
    - "The full pipeline works: ingest → enrich → approve → publish-sync → live site"
  artifacts:
    - path: "model-citizen-quartz/content/"
      provides: "At least one published article beyond index.md"
    - path: "~/.model-citizen/published-list.txt"
      provides: "Tracking entry for published note"
  key_links:
    - from: "publish_queue/*.md"
      to: "quartz content/"
      via: "publish-sync.sh"
      pattern: "publish-sync"
---

<objective>
Run the complete end-to-end pipeline: pick a YouTube video, ingest it, enrich it, create a draft, approve it, run publish-sync, and verify the article appears on the live Quartz site.

Purpose: Prove the entire Model Citizen system works from input to published output
Output: One published article visible at athan-dial.github.io/model-citizen/
</objective>

<execution_context>
@/Users/adial/.claude/get-shit-done/workflows/execute-plan.md
@/Users/adial/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-publish-sync/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Prepare a test note for publishing</name>
  <files>~/Library/Mobile Documents/iCloud~md~obsidian/Documents/model-citizen-vault/publish_queue/test-publish.md</files>
  <action>
Check if there are any existing notes in the vault that have been through enrichment (check enriched/, ideas/, drafts/ folders for content). If enriched content exists, pick the most complete note and create a publishable version in publish_queue/.

If NO enriched content exists yet, create a minimal but real test note in publish_queue/ with:
- Valid frontmatter (title, status: publish, created date, tags)
- 2-3 paragraphs of real content (a brief article about the Model Citizen system itself — meta but authentic)
- At least one [[wikilink]] to test Quartz native wikilink support

The goal is to have SOMETHING in publish_queue/ to test the pipeline. A real enriched note is preferred, but a hand-crafted test note works for proving the system.

Then run publish-sync.sh (NOT dry-run) to sync to Quartz:
```bash
bash ~/Library/Mobile\ Documents/iCloud~md~obsidian/Documents/model-citizen-vault/scripts/publish-sync.sh
```

Verify:
- Note appears in Quartz content/ directory
- Tracking file updated
- Git commit created in Quartz repo
  </action>
  <verify>
1. File exists in Quartz content/ directory (beyond just index.md)
2. Tracking file has an entry
3. Git log in Quartz repo shows publish commit
  </verify>
  <done>
publish-sync.sh successfully copied a note from publish_queue/ to Quartz content/, committed, and pushed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify Quartz builds locally</name>
  <files></files>
  <action>
In the Quartz repo, run a local build to verify the published content renders:

```bash
cd ~/Library/Mobile\ Documents/iCloud~md~obsidian/Documents/model-citizen-quartz
npx quartz build
```

Check that:
1. Build completes without errors
2. The new note appears in the public/ output directory
3. No broken links or missing assets in build output

If build fails, diagnose and fix the issue (likely frontmatter format or missing dependency).
  </action>
  <verify>
1. `npx quartz build` exits 0
2. New article HTML exists in public/ directory
  </verify>
  <done>
Quartz builds successfully with the published content included.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete publish sync pipeline: vault → Quartz → build verified. Git push to v4 branch should trigger GitHub Pages deployment automatically.</what-built>
  <how-to-verify>
1. Check if the Quartz repo push triggered a GitHub Pages build:
   - Visit https://github.com/athan-dial/model-citizen-quartz/actions (or whatever the repo name is)
   - Verify the deploy workflow ran successfully
2. Visit https://athan-dial.github.io/model-citizen/ and confirm:
   - The index page loads
   - The published article is visible and navigable
   - Wikilinks render correctly (if any)
3. If deploy hasn't triggered yet, manually push:
   ```bash
   cd ~/Library/Mobile\ Documents/iCloud~md~obsidian/Documents/model-citizen-quartz
   git push origin v4
   ```
  </how-to-verify>
  <resume-signal>Type "approved" if the published article is visible on the live site, or describe any issues.</resume-signal>
</task>

</tasks>

<verification>
1. At least one note synced from publish_queue/ to Quartz content/
2. Quartz builds locally without errors
3. Published article visible at athan-dial.github.io/model-citizen/
4. Tracking file records the published note
5. Re-running publish-sync.sh skips the already-published note (idempotency)
</verification>

<success_criteria>
- End-to-end pipeline demonstrated: content in vault → published on live Quartz site
- Quartz site accessible at athan-dial.github.io/model-citizen/ with published content
- publish-sync.sh is idempotent (re-run doesn't duplicate)
</success_criteria>

<output>
After completion, create `.planning/phases/09-publish-sync/09-02-SUMMARY.md`
</output>
